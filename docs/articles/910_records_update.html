<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caribbean Herp Records Update • caribmacro</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/slate/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Caribbean Herp Records Update">
<meta property="og:description" content="caribmacro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">caribmacro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://github.com/ieco-lab/caribmacro" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Contemporized IBT
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li>
      <a href="../articles/010_ibt_data_calcs.html">Data Calculations</a>
    </li>
    <li>
      <a href="../articles/011_bank_attributes.html">Bank Attributes</a>
    </li>
    <li>
      <a href="../articles/020_ibt_sr_avgmod_std.html">Contemporized IBT Analysis</a>
    </li>
    <li class="divider">
  </li>
</ul>
</li>
<li class="dropdown-header">Island Saturation Rescaling</li>
<li class="dropdown-header">Beta Diversity</li>
<li class="dropdown-header">Shipping Networks &amp; IBT</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc R Code
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li>
      <a href="../articles/900_functions.html">Functions</a>
    </li>
    <li>
      <a href="../articles/910_records_update.html">Sp Records Updates</a>
    </li>
    <li class="divider">
  </li>
</ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Caribbean Herp Records Update</h1>
                        <h4 data-toc-skip class="author">Jason M.
Gleditsch<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">06 December 2022</h4>
      
      
      <div class="hidden name"><code>910_records_update.Rmd</code></div>

    </div>

    
    
<p>This vignette explains how records were obtained from GBIF and added
to the data base. The code may have issues due to update with the
‘rgbif’ package. The outputs of the code are also not shown to make
rendering the vignette easier.</p>
<div class="section level2">
<h2 id="aim-and-scope">Aim and Scope<a class="anchor" aria-label="anchor" href="#aim-and-scope"></a>
</h2>
<p>The aim of this vignette is to show how we update our herpetological
records data with species records from the Global Biodiversity
Information Facility (GBIF) via two functions in the ‘caribmacro’
package.</p>
<p>First we need to load in the caribmacro package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Project package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gledits2.github.io/caribmacro/" class="external-link">caribmacro</a></span><span class="op">)</span></span></code></pre></div>
<p>If you do not have this package installed, then run
<code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all</a></code> in order to load all of the necessary
functions if you are running this code in the caribmacro R project in
the shared folder. If you are not, then see the Functions vignette for
the functions needed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load all of the functions of the caribmacro package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="st">"./"</span>, export_all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The other R packages needed for this are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GBIF Database Package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spatial Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/" class="external-link">rgeos</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org" class="external-link">rgdal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Graphing Package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gbif-records-retrieval">GBIF Records Retrieval<a class="anchor" aria-label="anchor" href="#gbif-records-retrieval"></a>
</h2>
<p>The first step to updating the herpetogical records in our database
is to retrieve all of the records of herpetofauna in the Caribbean
bioregion as described in Hedges et al. (2019) and Bermuda. This is done
by loading in a shapefile that outlines the area(s) of interest
(i.e. the region previously described) and using the
<code><a href="../reference/gbif_records.html">gbif_records()</a></code> function.</p>
<p>The shapefile needs to read in using the
<code><a href="http://rgdal.r-forge.r-project.org/reference/rgdal-deprecated.html" class="external-link">rgdal::readOGR()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in shapefile for Geographic bounds</span></span>
<span><span class="va">outline</span><span class="op">&lt;-</span><span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/rgdal-deprecated.html" class="external-link">readOGR</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'gis'</span>, <span class="st">'Carib_Poly.shp'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can use <code><a href="../reference/gbif_records.html">gbif_records()</a></code> to download the GBIF
records for certain groups of taxa. Here we are downloading the records
for the taxonomic classes ‘Reptilia’ and ‘Amphibia’ for the past two
years. The groups have to be of the same taxonomic rank.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Collect reptile and amphibian occurrences</span></span>
<span><span class="va">h.occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gbif_records.html">gbif_records</a></span><span class="op">(</span>groups  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Amphibia'</span>,<span class="st">'Reptilia'</span><span class="op">)</span>,</span>
<span>                      rank <span class="op">=</span> <span class="st">'class'</span>,</span>
<span>                      years <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                      bounds <span class="op">=</span> <span class="va">outline</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove the shapefile since it is large and can slow down the computer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">outline</span><span class="op">)</span></span></code></pre></div>
<p>It is important to know the default setting for this function because
you should check that these defaults returns all of the records you
want. The first default you should check is the number of records that
was returned by the function. The default setting for this is
<code>limit = 50000</code>, and to check if this is enough, all you have
to do is to see if the number of records for he the taxanomic groups
idividually is less than 50,000 (i.e. make sure the number of rows of
the data frame for a taxanomic group is less than 50,000). If it does,
then you should increase the limit (i.e. <code>limit = 60000</code>) and
check again.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">h.occ</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">h.occ</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Amphibia'</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">50000</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">h.occ</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">h.occ</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Reptilia'</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="fl">50000</span><span class="op">)</span></span></code></pre></div>
<p>As you can see we did not max out the limit of records for either
group. However, if either of the line of code above returned a
<code>TRUE</code>, then we would have had to increase the
<code>limit</code> argument. The function takes a while to run and will
take even longer the more records it searches for. Therefore, it is
recommended to only increase the limit in small increments.</p>
<p>The maximum number of records that can be retrieved for a single
group is 200,000. If you max out that limit then you need to break up
the time period into smaller intervals. The intervals are by year so if
you still max out the 200,000 record limit, then use smaller groups of
species (i.e. instead of using classes, like Reptilia, use orders, like
Squamata).</p>
<p>In order to break up the time period from which you want to retrieve
records, you need to understand how the function works. The
<code>years</code> argument sets the earliest year you want records by
subtracting the number of years you tell it to from another argument,
<code>yr_from</code>. The default for <code>yr_from</code> is the
current year of the computer (i.e. <code>substr(Sys.Date(), 1, 4)</code>
which at the time this vignette was made
<code>substr(Sys.Date(), 1, 4)</code> = 2022). Therefore, if you, for
example, want the records from 2016 through 2018, then you would set
<code>yr_from = 2018</code> and <code>years = 2</code>, but if you want
the records from 2018 through the current year, you only have to set
<code>years = 2</code> and use the default for <code>yr_from</code>.</p>
<p>Now let see what is returned by <code><a href="../reference/gbif_records.html">gbif_records()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">h.occ</span><span class="op">)</span></span></code></pre></div>
<p>As you can see only a subset of information is returned by
<code><a href="../reference/gbif_records.html">gbif_records()</a></code> (much more information is available about
the records in GBIF). However, this is the minimum amount of information
you need to check the credibility of these records.</p>
</div>
<div class="section level2">
<h2 id="records-bank-identification">Records’ Bank Identification<a class="anchor" aria-label="anchor" href="#records-bank-identification"></a>
</h2>
<p>You may have noticed that the <code><a href="../reference/gbif_records.html">gbif_records()</a></code> does not
tell you what geographic feature from which they came. For our purposes
we want to know from which what island banks the records came.
Unfortunately, the coordinates of the records are not that great making
the identification of the islands from which they came nearly
impossible. HOwever, this is currently being worked on to make this
possible.</p>
<p>To determine from where the records came we need a shapefile of the
geographic features of interest. We will do this using the
<code><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">sf::st_read()</a></code> function because it is faster and
<code>sf</code> objects are easier to work with.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in shapefile of Geographic Features</span></span>
<span><span class="va">carib.bnk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'gis'</span>, <span class="st">'Carib_Banks.shp'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The function we will use to label the records with their geographic
origin also filters out the records of species that we already have in
our database. Therefore, we also need to load our data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load in our data</span></span>
<span><span class="va">herp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'IBT_Herp_Records_final.csv'</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Now we can use the <code><a href="../reference/rec_update.html">rec_update()</a></code> function to select the
records that we do not have and label them with the island bank on which
they were recorded.</p>
<p>Note, that in <code><a href="../reference/rec_update.html">rec_update()</a></code> the argument
<code>geo_name = 'bank'</code> refers the name of the attribute in the
shapefile with the geographic feature names and the column in the data
that has those same names. These must match for the function to work
properly.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_recs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rec_update.html">rec_update</a></span><span class="op">(</span>gbif_occ <span class="op">=</span> <span class="va">h.occ</span>,</span>
<span>                       geography <span class="op">=</span> <span class="va">carib.bnk</span>,</span>
<span>                       geo_name <span class="op">=</span> <span class="st">'bank'</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">herp</span>,</span>
<span>                       sp_name <span class="op">=</span> <span class="st">'binomial'</span><span class="op">)</span></span></code></pre></div>
<p>Now when we look at the records we can see that a new column has been
created to denote the island bank the to which the records belong.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">new_recs</span><span class="op">)</span></span></code></pre></div>
<p>However, because the coordinates for the records are not that great,
you should plot a few of the island banks to see how the records match
their banks.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp1</span> <span class="op">&lt;-</span> <span class="va">carib.bnk</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">carib.bnk</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'puerto rico'</span> <span class="op">|</span> <span class="va">carib.bnk</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'mona'</span> <span class="op">|</span> </span>
<span>                          <span class="va">carib.bnk</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'monito'</span> <span class="op">|</span> <span class="va">carib.bnk</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'st croix'</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">tmp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">new_recs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">new_recs</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'puerto rico'</span> <span class="op">|</span> <span class="va">new_recs</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'mona'</span> <span class="op">|</span></span>
<span>                                    <span class="va">new_recs</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'monito'</span><span class="op">|</span> <span class="va">new_recs</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'st croix'</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp2</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">tmp2</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span><span class="op">)</span>, </span>
<span>                      crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">tmp1</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmp2</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmp2</span><span class="op">)</span> <span class="op">==</span> <span class="st">'bank'</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'bank2'</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">carib.bnk</span>, fill <span class="op">=</span> <span class="st">'azure2'</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bank</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bank2</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">68.25</span>, <span class="op">-</span><span class="fl">63.75</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">19.5</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Longitude'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Latitude'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'Puerto Rico and Nearby Banks'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tmp1</span> <span class="op">&lt;-</span> <span class="va">carib.bnk</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">carib.bnk</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'great bahama'</span> <span class="op">|</span> <span class="va">carib.bnk</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'little bahama'</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">tmp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">new_recs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">new_recs</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'great bahama'</span> <span class="op">|</span> </span>
<span>                                  <span class="va">new_recs</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'little bahama'</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp2</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">tmp2</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span><span class="op">)</span>, </span>
<span>                     crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">tmp1</span><span class="op">)</span><span class="op">$</span><span class="va">proj4string</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmp2</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tmp2</span><span class="op">)</span> <span class="op">==</span> <span class="st">'bank'</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'bank2'</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">carib.bnk</span>, fill <span class="op">=</span> <span class="st">'azure2'</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bank</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">bank2</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">'black'</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">80.5</span>, <span class="op">-</span><span class="fl">74</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">28</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Longitude'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Latitude'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">'The Bahama Banks'</span><span class="op">)</span></span></code></pre></div>
<p>These plot show the locations of the records in relation to their
banks. From these plots you can see how well the records match their
banks. Most likely, you will have many records that do not match that
well. However, even if all the records you download match perfectly, you
still need to check all of the records.</p>
<p>To check the records you first need to export the new records from R.
Because we want to keep a records of the GBIF records downloaded and
keep the package folder small, you need to export these records to the
shared folder. The code below will export the records into the
appropriate folder with the appropriate file name for the Caribbean
Macrosystems Project.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export records</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'G:'</span>, <span class="st">'Shared drives'</span>, <span class="st">'Caribbean Macrosystem'</span>, <span class="st">'data'</span>, </span>
<span>                  <span class="st">'biodiversity'</span>, <span class="st">'GBIF Records'</span>, </span>
<span>                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">'Carib_Herp_GBIF_Records_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'.csv'</span>, sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">herp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">new_recs</span>, <span class="va">path</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="checking-the-records">Checking the Records<a class="anchor" aria-label="anchor" href="#checking-the-records"></a>
</h2>
<p>Now that the new records are exported you need to check the records
for there credibility. This needs to be outside of <code>R</code>, but
let’s see what the new records data look like.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_recs</span><span class="op">)</span></span></code></pre></div>
<p>As you can see, the <code>new_recs</code> data frame looks the same
as the <code>h.occ</code> data frame. However there is another column in
the <code>new_recs</code> data frame that denotes if there are more than
one record for that species on that particular bank. This is the first
step in determining the credibility of the records. If a species has at
least five records for a patricular bank then you can mark it to be
included in the database. The species with fewer than five records for a
particular bank probably should not be included in the data base.
However, just because there is only a few records does not mean that
that record is bad. Additionally, you can reduce the number of records
you will have to check the credibility for by comparing the species
names to the list of synonyms in the database (this may be built into
the <code><a href="../reference/rec_update.html">rec_update()</a></code> function in the future).</p>
<p>The easiest way you can check the credibility of the record is to
look at the ‘basisOfRecord’ column. If that column says that record is
‘PRESERVED_SPECIMEN’ then you can take that record as research grade and
mark it to be included in the database.</p>
<p>If the record’s ‘basisOfRecord’ column says ‘HUMAN_OBSERVATION’ then
you need to check the source of the record. The ‘occurrenceID’ column
has a link to the iNaturalist posting for that record. By following that
link you can see the credibility of the identification. We only what IDs
that are designated “Research Grade” by iNaturalist. Most of the records
will be from iNaturalist. If there is no link in the ‘occurrenceID’
column, then check the ‘references’ column for the source of the record
and check that. On iNaturalist, you can also see all of the other
records of that species in a map. You can use also this to get an idea
of the first recording of the species and the validity of the record.
For instance if you see the species has been recorded on a particular
bank for multiple years than the validity of that species being on that
bank is high. All of the records you deem having high validity should be
marked for inclusion in the database.</p>
<p>Once you have marked all of the credible records, you need to do
literature searches following the literature search protocols to see if
there are any published records of that species on that bank. If so then
record the earliest reference.</p>
<p>After you do all of this, the records that were marked for inclusion
should be added to the database following those protocols.</p>
</div>
<div class="section level2">
<h2 id="end">End<a class="anchor" aria-label="anchor" href="#end"></a>
</h2>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Temple University, <a href="mailto:jmg5214@gmail.com" class="email">jmg5214@gmail.com</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jason M. Gleditsch, Matthew R. Helmus, Jocelyn E. Behm.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
