<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Calculations • caribmacro</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/slate/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data Calculations">
<meta property="og:description" content="caribmacro">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">caribmacro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://github.com/ieco-lab/caribmacro" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Contemporized IBT
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li>
      <a href="../articles/010_ibt_data_calcs.html">Data Calculations</a>
    </li>
    <li>
      <a href="../articles/011_bank_attributes.html">Bank Attributes</a>
    </li>
    <li>
      <a href="../articles/020_ibt_sr_avgmod_std.html">Contemporized IBT Analysis</a>
    </li>
    <li class="divider">
  </li>
</ul>
</li>
<li class="dropdown-header">Island Saturation Rescaling</li>
<li class="dropdown-header">Beta Diversity</li>
<li class="dropdown-header">Shipping Networks &amp; IBT</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc R Code
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li>
      <a href="../articles/900_functions.html">Functions</a>
    </li>
    <li>
      <a href="../articles/910_records_update.html">Sp Records Updates</a>
    </li>
    <li class="divider">
  </li>
</ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Calculations</h1>
                        <h4 data-toc-skip class="author">Jason M.
Gleditsch<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">06 December 2022</h4>
      
      
      <div class="hidden name"><code>010_ibt_data_calcs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="aim-and-scope">Aim and Scope<a class="anchor" aria-label="anchor" href="#aim-and-scope"></a>
</h2>
<p>Here we calculate the necessary data for the Island Biogeographic
Analyses of the Caribbean Herpetofauna. We will be determining the
species richness (SR) and phylogenetic species variability (PSV) for
each island bank in the Caribbean. Each of these values are going to be
calculated for various species groups (i.e. clades) as determined by the
taxonomic hierarchies for the reptile and amphibian species present in
the Caribbean Bioregion as delineated by Hedges et al. (2019) and
including Bermuda.</p>
<p>The SR will also be calculated for clades that are delineated by
using the phylogeny so that the group of species that are descendant
from each node are a clade.</p>
<p>First we need to load in the <code>caribmacro</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Project package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gledits2.github.io/caribmacro/" class="external-link">caribmacro</a></span><span class="op">)</span></span></code></pre></div>
<p>If you do not have this package installed, then run
<code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all</a></code> in order to load all of the necessary
functions if you are running this code in the caribmacro R project in
the shared folder. If you are not, then see the functions vignette for
the Functions needed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load all of the functions of the caribmacro package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="st">"./"</span>, export_all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Function needed ##</span></span>
<span><span class="co">#   'hierarchy'  -&gt; returns the taxonomic hierarcy</span></span>
<span><span class="co">#   'com_matrix'  -&gt; determines the communities within geographic features</span></span>
<span><span class="co">#   'SR_geo'  -&gt; calculates the species richness within geographic features</span></span>
<span><span class="co">#   'PSV_geo'  -&gt; calculates the psv within geographic features</span></span>
<span><span class="co">#   'clade_age'  -&gt; calculates the crown age of clades</span></span>
<span><span class="co">#   'node_clades'  -&gt; determines the clades of species based on phylogenetic nodes</span></span>
<span><span class="co">#   'clade_area'  -&gt; determines the number of geographic feature each clade is found on</span></span>
<span><span class="co">#   'row_max'  -&gt; determines the maximum value in each row of a data frame</span></span>
<span><span class="co">#   'factorize'  -&gt; turns character columns of a data frame into factors</span></span></code></pre></div>
<p>The other R packages needed for this are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## here() starts at C:/Users/tun71056/OneDrive - Temple University/Shared drives/Caribbean Macrosystem/caribmacro</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/reshape" class="external-link">reshape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/heliosdrm/pwr" class="external-link">pwr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spatial Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Linking to GEOS 3.9.1, GDAL 3.4.3, PROJ 7.2.1; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgeos/" class="external-link">rgeos</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: sp</span></span></code></pre>
<pre><code><span><span class="co">## rgeos version: 0.5-9, (SVN revision 684)</span></span>
<span><span class="co">##  GEOS runtime version: 3.9.1-CAPI-1.14.2 </span></span>
<span><span class="co">##  Please note that rgeos will be retired by the end of 2023,</span></span>
<span><span class="co">## plan transition to sf functions using GEOS at your earliest convenience.</span></span>
<span><span class="co">##  GEOS using OverlayNG</span></span>
<span><span class="co">##  Linking to sp version: 1.5-0 </span></span>
<span><span class="co">##  Polygon checking: TRUE</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analytical Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://factominer.free.fr" class="external-link">FactoMineR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Diversity Database Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/taxize/" class="external-link">taxize</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Phylogenetic Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://daijiang.github.io/phyr/" class="external-link">phyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Graphing Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="island-banks">Island Banks<a class="anchor" aria-label="anchor" href="#island-banks"></a>
</h2>
<p>For our analyses we will be clustering the islands in the Caribbean
into banks based on Powell and Henderson 2012 and Hedges et al. 2019. To
further delineate banks we used the General Bathymetric Chart of the
Oceans (GEBCO Compilation Group 2020, downloaded September 2020) to
group islands based on the under water topography.</p>
<p>Let’s now take a look at the banks.</p>
<p><img src="010_ibt_data_calcs_files/figure-html/mcp%20plot-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="taxonomic-clade-communities">Taxonomic Clade Communities<a class="anchor" aria-label="anchor" href="#taxonomic-clade-communities"></a>
</h2>
<div class="section level3">
<h3 id="community-attributes">Community Attributes<a class="anchor" aria-label="anchor" href="#community-attributes"></a>
</h3>
<p>Now that we have determined bank area, we can now start working on
the Community attributes. These attributes are their species richness
(SR) and phylogenetic species variability (PSV).</p>
<div class="section level4">
<h4 id="species-hierarchy">Species Hierarchy<a class="anchor" aria-label="anchor" href="#species-hierarchy"></a>
</h4>
<p>We will calculate SR and PSV for various clades of species on each
bank. Therefore, we need to determine the species hierarchies first. We
will do this using a function in the ‘caribherp’ package. This function
is <code><a href="../reference/hierarchy.html">hierarchy()</a></code> and uses the package ‘taxize’ to look up and
download species hierarchies. The function in ‘taxize’ it uses makes
mistakes, and therefore, we need to check any errors outside of R. Once
any errors are fixed we then load the data back in. When we checked our
species hierarchies we saw that a couple species names were matched with
an insect or a plant species. The rest of the errors were all due to
misspellings or ids that were only to the genus level.</p>
<p>For this we need to read in the species occurrence data in the
‘data_raw’ folder.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">herp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'IBT_Herp_Records_final_SR_Drivers.csv'</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>With the species occurrence data we can now run the
<code><a href="../reference/hierarchy.html">hierarchy()</a></code> function and save the resulting data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carib.hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hierarchy.html">hierarchy</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">herp</span>, species <span class="op">=</span> <span class="st">'binomial'</span>, db <span class="op">=</span> <span class="st">'gbif'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Need to check/correct any errors and missing hierarchies in Excel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">carib.hier</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'supporting_data'</span>, <span class="st">'IBT_Carib_Sp_Taxonomy_v0.csv'</span><span class="op">)</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Remember, we need to check the data outside R for errors and fix
those errors. Once we do that we can then load in the new fixed
hierarchies and merge it with the occurrence data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">carib.hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'supporting_data'</span>, <span class="st">'IBT_Carib_Sp_Taxonomy_v1.csv'</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine Hierarchies with Occurrence Data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">carib.hier</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">carib.hier</span><span class="op">)</span> <span class="op">==</span> <span class="st">'sp_in_Data'</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'binomial'</span></span>
<span></span>
<span><span class="va">herp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">herp</span>, <span class="va">carib.hier</span>, by <span class="op">=</span> <span class="st">'binomial'</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check once more to see if we are missing any hierarchies</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for species missing their hierarchy</span></span>
<span><span class="va">herp</span><span class="op">$</span><span class="va">binomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">chk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Genus</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">chk</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<p>We can see that there are no missing hierarchies in our species
occurrence data. However, the <code><a href="../reference/hierarchy.html">hierarchy()</a></code> function only
finds a species “typical” taxonomic hierarchy. If we want to add in
certain groups that are not a kingdom, phylum, class, order, family, or
genus, than we need to add them manually. Because we are interested in
all snakes, geckos, and skinks , we will include the species’ suborders
or smaller groups so that we include groups of interest. For instance,
the non-Iguania squamates were broken up into the infraorders Gekkota,
Amphisbaenia, Scincomorpha, and Anguimorpha (which combines the
infraorders Diploglossa and Platynota in our data) and the superfamily
Gymnophthalmoidea.</p>
<p>The suborder/infraorder groups were determined by searching the
species’ families on the Integrated Taxonomic Information System (ITIS)
and then doing a web search if the family’s ITIS standard report page
did not list a suborder/infraorder.</p>
<p>However, the searches on ITIS illuminated a potential error in the
identification of the Natricidae family. The family has is typically
been considered a subfamily of Colubridae (Pryon et al. 2011).
Therefore, we will change this family to match ITIS.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fix Family Error</span></span>
<span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Family</span><span class="op">==</span><span class="st">'Natricidae'</span><span class="op">)</span>, <span class="st">'Family'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Colubridae'</span></span>
<span></span>
<span><span class="co"># Add suborder groups</span></span>
<span><span class="va">sorder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_raw'</span>, <span class="st">'supporting_data'</span>, <span class="st">'IBT_Carib_Suborders.csv'</span><span class="op">)</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">herp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">herp</span>, <span class="va">sorder</span>, by <span class="op">=</span> <span class="st">'Family'</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">carib.hier</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">carib.hier</span>, <span class="va">sorder</span>, by <span class="op">=</span> <span class="st">'Family'</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Suborder</span><span class="op">)</span>, <span class="st">'Family'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">chk</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="community-matrices">Community Matrices<a class="anchor" aria-label="anchor" href="#community-matrices"></a>
</h4>
<p>Now that we have the hierarches for each species in our occurrence
data, we can create the community matrices for each clade. These
matrices will comprise of j columns, where j equals the number of
species in the clade, and k rows, where k equals the number of banks the
clade is recorded on. Each cell is then populated by a 1 or 0, where 1
represents the presence of the jth species on the kth bank, and 0
represents its absence.</p>
<p>In order to create these matrices we will use the
<code><a href="../reference/com_matrix.html">com_matrix()</a></code> function from the ‘caribmacro’ package. This
function returns a named list of i community matrices where i is the
number of species groups. In our case we will create a community matrix
for all herpetofuana and all of the classes, orders, families, and
genuses in our occurrence data. Additionally, we will break up each of
these clades based on thier status on the banks (i.e. native or exotic)
and the entire clade. This comes out to be 693 species groups.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First simplify bank status</span></span>
<span><span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">herp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'bnk_status'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'bnk_status'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'E'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'E'</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'bnk_status'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'FE'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'N'</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'bnk_status'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'N'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'N'</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'bnk_status'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'PX'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'N'</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'bnk_status'</span><span class="op">]</span> <span class="op">==</span> <span class="st">'U'</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'E'</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'X'</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">herp</span><span class="op">[</span><span class="va">i</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'X'</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Fix specific statuses</span></span>
<span><span class="co">## Considered extinct</span></span>
<span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">binomial</span> <span class="op">==</span> <span class="st">'Crocodylus rhombifer'</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'grand cayman'</span><span class="op">)</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'X'</span> </span>
<span><span class="co">## Considered introduced by caribherp.org</span></span>
<span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">binomial</span> <span class="op">==</span> <span class="st">'Chelonoidis carbonarius'</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">bank</span> <span class="op">==</span> <span class="st">'anguilla'</span><span class="op">)</span>, <span class="st">'stat_new'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'E'</span> </span>
<span></span>
<span>           </span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">coms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/com_matrix.html">com_matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">herp</span>,</span>
<span>                   species <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                   geo_group <span class="op">=</span> <span class="st">"bank"</span>,</span>
<span>                   taxa_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Genus"</span>, <span class="st">"Family"</span>, <span class="st">"Suborder"</span>, <span class="st">"Order"</span>, <span class="st">"Class"</span><span class="op">)</span>,</span>
<span>                   status <span class="op">=</span> <span class="st">"stat_new"</span>,</span>
<span>                   stat_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>                   total <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##    6.19    0.15    6.34</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List the statuses excluded from the analyses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">==</span> <span class="st">'X'</span><span class="op">)</span>, <span class="st">'bnk_status'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "EI" "F"  "FE" "G"  "H"  "W"</span></span></code></pre>
<p>For our analyses we are changing ‘unknown’ (U) statuses to ‘exotic’
(E) and the ‘possibly extinct’ (PE) and ‘have fossil but extant’ (FE)
statuses to ‘native’ (N). We are also excluding ‘only known by fossils’
(F), ‘waifs’ (W), ‘extirpated exotics’ (EI), and records only identified
to the genus level but the genus is found elsewhere on the bank (G).</p>
<p>Because our the way we are grouping species hierarchical, we may have
clades that have the same species (e.g. the suborder clade Eusuchia has
all of the same species as the order Crocodilia). Let’s check to see if
this occurs in our data by looking at how many clades there are in the
each level downstream from a clade. Those clades that only have one
clade in a lower level will have the same species as the lower
level.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tst</span> <span class="op">&lt;-</span> <span class="va">herp</span></span>
<span><span class="va">tst</span><span class="op">$</span><span class="va">binomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">tst</span><span class="op">$</span><span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Class"</span>, <span class="st">"Order"</span>, <span class="st">"Suborder"</span>, <span class="st">"Family"</span>, <span class="st">"Genus"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'list'</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lists</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">grps</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tst</span><span class="op">[</span>, <span class="va">grps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">tst</span><span class="op">[</span>, <span class="va">grps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">lists</span><span class="op">[[</span><span class="va">grps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">tst</span><span class="op">[</span>, <span class="va">grps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lists</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lists</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lists</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">tst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tst</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lists</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">lists</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'binomial'</span>, <span class="va">grps</span><span class="op">[</span><span class="op">(</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grps</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">lvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>          <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Group.1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">lists</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Grp.1.lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">grps</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Group.2 <span class="op">=</span> <span class="va">lvls</span>,</span>
<span>                            Grp.2.lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">grps</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Different <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>          </span>
<span>          <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">lvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">temp</span><span class="op">[</span>, <span class="va">k</span><span class="op">]</span><span class="op">)</span></span>
<span>          <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Group.1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">lists</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Grp.1.lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Group.2 <span class="op">=</span> <span class="va">lvls</span>,</span>
<span>                            Grp.2.lvl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">grps</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">[</span><span class="va">k</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Different <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lvls</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>          </span>
<span>          <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">out</span>, <span class="va">tmp</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="cn">NA</span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">tst</span>, <span class="va">temp</span>, <span class="va">tmp</span>, <span class="va">lists</span>, <span class="va">grps</span>, <span class="va">lvls</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To check that the code work:</span></span>
<span><span class="co"># View(out[!out$Different, ])</span></span>
<span></span>
<span><span class="va">rem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">out</span><span class="op">[</span><span class="op">!</span><span class="va">out</span><span class="op">$</span><span class="va">Different</span>, <span class="st">'Group.1'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Clades removed (n = '</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rem</span><span class="op">)</span>, <span class="st">') \n'</span>, <span class="st">'\n'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">rem</span>, collapse <span class="op">=</span> <span class="st">" | "</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Clades removed (n = 29) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Agamidae | Amphisbaenidae | Anguidae | Anomalepididae | Cadeidae | Caudata | Centrolenidae | Crocodylia | Crocodylidae | Dactyloidae | Elapidae | Eleutherodactylidae | Eublepharidae | Geoemydidae | Hemiphractidae | Kinosternidae | Leiocephalidae | Leptodactylidae | Mesobatrachia | Pelomedusidae | Phrynosomatidae | Pipidae | Polychrotidae | Salamandridae | Salamandroidea | Strabomantidae | Tropidophiidae | Varanidae | Xantusiidae</span></span></code></pre>
<p>As you can see there are a lot of clades that contain the same
species as younger clades. Because this would be psuedoreplication
(i.e. the same species group analyzed twice), we need to remove these
clades from our analyses.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">'.T'</span>, <span class="st">''</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coms</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'.T'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coms</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">good</span>, <span class="st">"."</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">rem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">rem</span>, <span class="st">"."</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="va">good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">good</span>, <span class="va">rem</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">coms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coms</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">good</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coms</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">good</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">coms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coms</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="va">good</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">coms</span><span class="op">)</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">coms</span> <span class="op">&lt;-</span> <span class="va">tmp</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">good</span>, <span class="va">tmp</span>, <span class="va">rem</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="species-richness-calculation">Species Richness Calculation<a class="anchor" aria-label="anchor" href="#species-richness-calculation"></a>
</h4>
<p>Now that we have the community matrices we can calculate the species
richness (SR) of each species group on each bank. To do this we will use
the <code><a href="../reference/SR_geo.html">SR_geo()</a></code> function in the ‘caribmacro’ package.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">SR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SR_geo.html">SR_geo</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">coms</span>, geo_group <span class="op">=</span> <span class="st">"bank"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##    2.29    0.02    2.31</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SR_out</span> <span class="op">&lt;-</span> <span class="va">SR</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="clade-species-richness">Clade Species Richness<a class="anchor" aria-label="anchor" href="#clade-species-richness"></a>
</h4>
<p>We may also want to include the species richness of each clade in our
analysis, because the clades may differ in their speciation rates. We
will only calculate this for the Caribbean Bioregion. Therefore, the SR
of each clade will represent the rate a clade will add a species due to
speciation (for the native species richness) or both speciation and
species introduction (both native and exotic species richness) in the
Caribbean Bioregion.</p>
<p>We will calculate clade SR in a similar way to bank SR (see above).
However, instead of setting <code>geo_group = "bank"</code>, we will set
<code>geo_group = "region"</code> in the <code><a href="../reference/com_matrix.html">com_matrix()</a></code>
function, where ‘region’ is set to ‘carib’ representing the
Caribbean.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">herp</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="st">'carib'</span></span>
<span><span class="va">clade.coms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/com_matrix.html">com_matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">herp</span>,</span>
<span>                         species <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                         geo_group <span class="op">=</span> <span class="st">"region"</span>,</span>
<span>                         taxa_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Genus"</span>, <span class="st">"Family"</span>, <span class="st">"Suborder"</span>, <span class="st">"Order"</span>, <span class="st">"Class"</span><span class="op">)</span>,</span>
<span>                         status <span class="op">=</span> <span class="st">"stat_new"</span>,</span>
<span>                         stat_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>                         total <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clade.SR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SR_geo.html">SR_geo</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">clade.coms</span>, geo_group <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'region'</span><span class="op">)</span><span class="op">]</span>, <span class="st">"."</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clade.SR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'region'</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Taxon'</span>, <span class="st">'Group'</span>, <span class="st">'SR'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="clade-pa-matrix">Clade P/A Matrix<a class="anchor" aria-label="anchor" href="#clade-pa-matrix"></a>
</h4>
<p>It may be important to have a matrix that has the presence and
absence of species in each clade</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">binomial</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cld.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clade.SR</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sp</span></span>
<span><span class="va">cld.mat</span><span class="op">$</span><span class="va">Clade</span> <span class="op">&lt;-</span> <span class="va">clade.SR</span><span class="op">$</span><span class="va">Taxon</span></span>
<span><span class="va">cld.mat</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="va">clade.SR</span><span class="op">$</span><span class="va">Group</span></span>
<span></span>
<span><span class="va">cld.mat</span> <span class="op">&lt;-</span> <span class="va">cld.mat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Clade'</span>, <span class="st">'Group'</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> </span>
<span>                                                                     <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Group'</span><span class="op">]</span> <span class="op">!=</span> <span class="st">'T'</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Group'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Order</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Order</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Group'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Suborder</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Suborder</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Group'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Family</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Family</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Group'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Genus</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Genus</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">herp</span><span class="op">$</span><span class="va">stat_new</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Group'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="cn">NA</span><span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Class</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Order</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Order</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Suborder</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Suborder</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Family</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Family</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span>, <span class="va">herp</span><span class="op">$</span><span class="va">Genus</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">herp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">herp</span><span class="op">$</span><span class="va">Genus</span> <span class="op">==</span> <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="st">'Clade'</span><span class="op">]</span><span class="op">)</span>, <span class="st">'binomial'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">tmp.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">tmp.sp</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="va">tmp.sp</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">cld.mat</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span>, <span class="va">tmp.sp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="cn">NA</span><span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cld.mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">$</span><span class="va">Clade</span> <span class="op">==</span> <span class="st">'All'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Clade'</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cld.mat</span><span class="op">)</span> <span class="op">!=</span> <span class="st">'Group'</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="data-saving">Data Saving<a class="anchor" aria-label="anchor" href="#data-saving"></a>
</h3>
<p>Now lets save all of the community and clade attributes we calculated
in the ‘data_out’ folder. We also want to save the clade SR and the
Caribbean species taxonomy in the supp_info folder.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Data for data_out</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">SR_out</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_out'</span>, <span class="st">'sr_drivers'</span>, <span class="st">'SR_Drivers_Herp_SR.csv'</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">clade.SR</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_out'</span>, <span class="st">'sr_drivers'</span>, <span class="st">'SR_Drivers_Clade_SR.csv'</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data for supp_info</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">carib.hier</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_out'</span>, <span class="st">'sr_drivers'</span>, <span class="st">'supp_info'</span>, <span class="st">'SR_Drivers_Carib_Taxonomy.csv'</span><span class="op">)</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">cld.mat</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'data_out'</span>, <span class="st">'sr_drivers'</span>, <span class="st">'supp_info'</span>, <span class="st">'SR_Drivers_Taxonomy_Clade_Matrix.csv'</span><span class="op">)</span>, row.names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Temple University, <a href="mailto:jmg5214@gmail.com" class="email">jmg5214@gmail.com</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jason M. Gleditsch, Matthew R. Helmus, Jocelyn E. Behm.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
